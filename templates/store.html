<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRANITE MODELS - Models Store</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold:#ffaa00; --gold-bright:#ffd700; --gold-dim:#b8860b;
            --dark-bg:#0a0a0f; --dark-surface:#111118; --dark-card:#1a1a25;
            --dark-border:#2a2a3a; --text-primary:#e8e8f0; --text-secondary:#8888aa;
            --green:#00ff88; --red:#ff4444; --purple:#aa44ff; --cyan:#00ddff;
        }
        *{margin:0;padding:0;box-sizing:border-box;}
        body{background:var(--dark-bg);color:var(--text-primary);font-family:'Rajdhani',sans-serif;min-height:100vh;}
        body::before{content:'';position:fixed;top:0;left:0;right:0;bottom:0;
            background:linear-gradient(rgba(255,170,0,0.03) 1px,transparent 1px),
            linear-gradient(90deg,rgba(255,170,0,0.03) 1px,transparent 1px);
            background-size:50px 50px;pointer-events:none;z-index:0;}
        .store-header{text-align:center;padding:40px 20px 30px;position:relative;z-index:1;border-bottom:1px solid var(--dark-border);}
        .store-header h1{font-family:'Orbitron',monospace;color:var(--gold);font-size:2.2em;letter-spacing:4px;text-shadow:0 0 30px rgba(255,170,0,0.4);}
        .store-header .sub{color:var(--text-secondary);font-size:1em;letter-spacing:2px;margin-top:8px;}
        .back-link{position:absolute;left:30px;top:50%;transform:translateY(-50%);color:var(--gold);text-decoration:none;font-weight:700;font-size:0.9em;}
        .stats-bar{display:flex;justify-content:center;gap:40px;padding:15px;background:var(--dark-surface);border-bottom:1px solid var(--dark-border);position:relative;z-index:1;flex-wrap:wrap;}
        .stats-bar .stat{text-align:center;}
        .stats-bar .stat-val{font-family:'Orbitron',monospace;color:var(--gold);font-size:1.3em;}
        .stats-bar .stat-label{font-size:0.7em;color:var(--text-secondary);text-transform:uppercase;letter-spacing:1px;}
        .filters{display:flex;gap:10px;justify-content:center;padding:20px;flex-wrap:wrap;position:relative;z-index:1;}
        .filter-btn{padding:8px 20px;border:1px solid var(--dark-border);background:var(--dark-card);color:var(--text-secondary);border-radius:20px;cursor:pointer;font-family:'Rajdhani',sans-serif;font-weight:600;font-size:0.9em;transition:all 0.2s;letter-spacing:1px;}
        .filter-btn:hover,.filter-btn.active{border-color:var(--gold);color:var(--gold);background:rgba(255,170,0,0.1);}
        .search-bar{max-width:500px;margin:0 auto;padding:0 20px;position:relative;z-index:1;}
        .search-input{width:100%;padding:12px 20px;background:var(--dark-surface);border:1px solid var(--dark-border);border-radius:25px;color:var(--text-primary);font-family:'Rajdhani',sans-serif;font-size:1em;}
        .search-input:focus{outline:none;border-color:var(--gold);}
        .product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:20px;padding:20px 30px;position:relative;z-index:1;max-width:1400px;margin:0 auto;}
        .product-card{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:12px;padding:24px;transition:all 0.3s;cursor:pointer;position:relative;display:flex;flex-direction:column;}
        .product-card:hover{border-color:var(--gold);transform:translateY(-3px);box-shadow:0 8px 30px rgba(255,170,0,0.1);}
        .cat-badge{display:inline-block;padding:3px 12px;border-radius:20px;font-size:0.7em;font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;}
        .video-badge{position:absolute;top:15px;right:15px;padding:4px 10px;border-radius:8px;font-size:0.65em;font-weight:700;background:rgba(0,255,136,0.15);color:var(--green);letter-spacing:1px;}
        .no-video-badge{position:absolute;top:15px;right:15px;padding:4px 10px;border-radius:8px;font-size:0.65em;font-weight:700;background:rgba(255,68,68,0.1);color:#ff6666;letter-spacing:1px;}
        .product-card h3{color:var(--gold);font-family:'Orbitron',monospace;font-size:0.95em;margin-bottom:8px;}
        .product-card .port{color:var(--text-secondary);font-size:0.75em;font-family:monospace;margin-bottom:10px;}
        .product-card .desc{color:var(--text-secondary);font-size:0.9em;line-height:1.5;margin-bottom:15px;flex-grow:1;}
        .product-card .features{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:15px;}
        .product-card .feat{padding:3px 8px;background:rgba(255,170,0,0.08);border:1px solid rgba(255,170,0,0.15);border-radius:4px;font-size:0.75em;color:var(--text-secondary);}
        .product-card .price-row{display:flex;justify-content:space-between;align-items:center;margin-top:auto;padding-top:15px;border-top:1px solid var(--dark-border);}
        .product-card .price{font-family:'Orbitron',monospace;font-size:1.5em;color:var(--gold);}
        .buy-btn{padding:8px 20px;border:1px solid var(--gold);background:rgba(255,170,0,0.15);color:var(--gold);border-radius:8px;font-family:'Rajdhani',sans-serif;font-weight:700;cursor:pointer;transition:all 0.2s;font-size:0.9em;}
        .buy-btn:hover{background:var(--gold);color:var(--dark-bg);}
        .cat-section{padding:10px 30px 5px;position:relative;z-index:1;max-width:1400px;margin:0 auto;}
        .cat-title{font-family:'Orbitron',monospace;font-size:1em;letter-spacing:2px;padding-bottom:8px;border-bottom:1px solid var(--dark-border);margin-bottom:5px;}
    </style>
<link rel="icon" href="/static/favicon.ico" type="image/x-icon"></head>
<body>
    <div class="store-header">
        <h1>MODELS STORE</h1>
        <div class="sub">30 AUTOMATION SYSTEMS &middot; DEMO VIDEOS &middot; ONE-TIME PURCHASE</div>
    </div>

    <div class="stats-bar">
        <div class="stat"><div class="stat-val" id="total-products">30</div><div class="stat-label">Systems</div></div>
        <div class="stat"><div class="stat-val" style="color:var(--green);" id="video-count">0</div><div class="stat-label">Demo Videos</div></div>
        <div class="stat"><div class="stat-val" style="color:var(--cyan);" id="total-orders">0</div><div class="stat-label">Orders</div></div>
        <div class="stat"><div class="stat-val" style="color:var(--purple);" id="total-rev">$0</div><div class="stat-label">Revenue</div></div>
    </div>
    <div style="padding:20px 0;">
        <div class="search-bar">
            <input class="search-input" id="search" placeholder="Search systems..." oninput="filterProducts()">
        </div>
    </div>
    <div class="filters">
        <button class="filter-btn active" onclick="setFilter('all',this)">All (30)</button>
        <button class="filter-btn" onclick="setFilter('lead-sales',this)">Lead &amp; Sales</button>
        <button class="filter-btn" onclick="setFilter('marketing',this)">Marketing</button>
        <button class="filter-btn" onclick="setFilter('operations',this)">Operations</button>
        <button class="filter-btn" onclick="setFilter('communication',this)">Communication</button>
        <button class="filter-btn" onclick="setFilter('finance',this)">Finance</button>
        <button class="filter-btn" onclick="setFilter('reporting',this)">Reporting</button>
        <button class="filter-btn" onclick="setFilter('automation',this)">Automation</button>
    </div>
    <div class="product-grid" id="product-grid"></div>

    <script>
    let allProducts=[], currentCat='all';
    async function loadProducts(){
        const res=await fetch('/api/products');
        allProducts=await res.json();
        renderProducts(); loadStats();
    }
    async function loadStats(){
        const s=await(await fetch('/api/store/stats')).json();
        document.getElementById('total-products').textContent=s.total_products;
        document.getElementById('video-count').textContent=s.video_count;
        document.getElementById('total-orders').textContent=s.total_orders;
        document.getElementById('total-rev').textContent='$'+s.total_revenue.toLocaleString();
    }
    function renderProducts(){
        const search=document.getElementById('search').value.toLowerCase();
        let filtered=allProducts.filter(p=>{
            if(currentCat!=='all'&&p.category!==currentCat)return false;
            if(search&&!p.name.toLowerCase().includes(search)&&!p.desc.toLowerCase().includes(search))return false;
            return true;
        });
        const grid=document.getElementById('product-grid');
        grid.innerHTML=filtered.map(p=>`
            <div class="product-card" onclick="window.location='/product/${p.id}'">
                ${p.has_video?'<div class="video-badge">â–¶ DEMO</div>':'<div class="no-video-badge">PENDING</div>'}
                <div class="cat-badge" style="background:${p.cat_color}22;color:${p.cat_color};border:1px solid ${p.cat_color}44;">${p.cat_icon} ${p.cat_name}</div>
                <h3>${p.name}</h3>
                <div class="port">Port ${p.port}</div>
                <div class="desc">${p.desc}</div>
                <div class="features">${p.features.slice(0,4).map(f=>'<span class="feat">'+f+'</span>').join('')}</div>
                <div class="price-row">
                    <div class="price">$${p.price}</div>
                </div>
            </div>
        `).join('');
        if(!filtered.length)grid.innerHTML='<div style="grid-column:1/-1;text-align:center;padding:60px;color:var(--text-secondary);">No systems match.</div>';
    }
    function setFilter(cat,btn){
        currentCat=cat;
        document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        renderProducts();
    }
    function filterProducts(){renderProducts();}
    async function buyProduct(id){
        const res=await fetch('/api/checkout/'+id,{method:'POST'});
        const d=await res.json();
        if(d.url)window.location=d.url;
        else if(d.error)alert(d.error);
    }
    loadProducts();
    </script>
</body>
</html>
    <div class="stats-bar">
        <div class="stat"><div class="stat-val" id="total-products">30</div><div class="stat-label">Systems</div></div>
        <div class="stat"><div class="stat-val" style="color:var(--green);" id="video-count">0</div><div class="stat-label">Demo Videos</div></div>
        <div class="stat"><div class="stat-val" style="color:var(--cyan);" id="total-orders">0</div><div class="stat-label">Orders</div></div>
        <div class="stat"><div class="stat-val" style="color:var(--purple);" id="total-rev">$0</div><div class="stat-label">Revenue</div></div>
    </div>
    <div style="padding:20px 0;">
        <div class="search-bar">
            <input class="search-input" id="search" placeholder="Search systems..." oninput="filterProducts()">
        </div>
    </div>
    <div class="filters">
        <button class="filter-btn active" onclick="setFilter('all',this)">All (30)</button>
        <button class="filter-btn" onclick="setFilter('lead-sales',this)">Lead &amp; Sales</button>
        <button class="filter-btn" onclick="setFilter('marketing',this)">Marketing</button>
        <button class="filter-btn" onclick="setFilter('operations',this)">Operations</button>
        <button class="filter-btn" onclick="setFilter('communication',this)">Communication</button>
        <button class="filter-btn" onclick="setFilter('finance',this)">Finance</button>
        <button class="filter-btn" onclick="setFilter('reporting',this)">Reporting</button>
        <button class="filter-btn" onclick="setFilter('automation',this)">Automation</button>
    </div>
    <div class="product-grid" id="product-grid"></div>
    <script>
    let allProducts=[], currentCat='all';
    const catColors={'lead-sales':'#00e0ff','marketing':'#ff4d9e','operations':'#00ff88',
        'communication':'#aa44ff','finance':'#ffaf00','reporting':'#00ddff','automation':'#ff6600'};
    async function loadProducts(){
        const res=await fetch('/api/products');
        allProducts=await res.json();
        renderProducts(); loadStats();
    }
    async function loadStats(){
        const s=await(await fetch('/api/store/stats')).json();
        document.getElementById('total-products').textContent=s.total_products;
        document.getElementById('video-count').textContent=s.video_count;
        document.getElementById('total-orders').textContent=s.total_orders;
        document.getElementById('total-rev').textContent='$'+s.total_revenue.toLocaleString();
    }
    function renderProducts(){
        const search=document.getElementById('search').value.toLowerCase();
        let filtered=allProducts.filter(p=>{
            if(currentCat!=='all'&&p.category!==currentCat) return false;
            if(search&&!p.name.toLowerCase().includes(search)&&!p.desc.toLowerCase().includes(search)) return false;
            return true;
        });
        const grid=document.getElementById('product-grid');
        grid.innerHTML=filtered.map(p=>{
            const cc=catColors[p.category]||'#ffaa00';
            return `<div class="product-card" onclick="window.location='/product/${p.id}'">
                ${p.has_video?'<div class="video-badge">&#9654; DEMO</div>':'<div class="no-video-badge">PENDING</div>'}
                <div class="cat-badge" style="background:${cc}22;color:${cc};border:1px solid ${cc}44">${p.cat_icon} ${p.cat_name}</div>
                <h3>${p.name}</h3>
                <div class="port">Port ${p.port}</div>
                <div class="desc">${p.desc}</div>
                <div class="features">${p.features.slice(0,4).map(f=>'<span class="feat">'+f+'</span>').join('')}</div>
                <div class="price-row">
                    <div class="price">$${p.price}</div>
                </div>
            </div>`;
        }).join('');
        if(!filtered.length) grid.innerHTML='<div style="grid-column:1/-1;text-align:center;padding:60px;color:var(--text-secondary);">No systems match.</div>';
    }
    function setFilter(cat,btn){
        currentCat=cat;
        document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        renderProducts();
    }
    function filterProducts(){renderProducts();}
    async function buyProduct(pid){
        const res=await fetch('/api/checkout/'+pid,{method:'POST'});
        const data=await res.json();
        if(data.url) window.location=data.url;
        else if(data.error) alert('Error: '+data.error);
    }
    loadProducts();
    </script>
</body>
</html>
